<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Liu Yao" />

<meta name="date" content="2024-12-08" />

<title>Homework by SA24204137</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Homework by SA24204137</h1>
<h4 class="author">Liu Yao</h4>
<h4 class="date">2024-12-08</h4>



<div id="question-3.4" class="section level2">
<h2>Question 3.4</h2>
<p>Generate Rayleigh(σ) samples for several choices of σ &gt; 0 and
check that the mode of the generated samples is close to the theoretical
mode σ (check the histogram).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>answer_3_4 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, sigma){</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="co"># 定义使用逆变换法生成Rayleigh(σ)分布随机样本的函数</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  simulate_rayleigh <span class="ot">&lt;-</span> <span class="cf">function</span>(n, sigma) {</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="fu">return</span>(sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(u)))</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  }</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  rayleigh_samples <span class="ot">&lt;-</span> <span class="fu">simulate_rayleigh</span>(n, sigma)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="co"># 绘制Rayleigh(σ)分布随机样本的直方图</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="fu">hist</span>(rayleigh_samples, <span class="at">prob =</span> <span class="cn">TRUE</span>, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;Rayleigh(σ =&quot;</span>, sigma, <span class="st">&quot;) Distribution&quot;</span>))</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="co"># 将Rayleigh(σ)理论密度函数叠加在直方图上</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  x_vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(<span class="fu">simulate_rayleigh</span>(n, sigma)), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  rayleigh_pdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x, sigma) {</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    (x <span class="sc">/</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>  }</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="fu">lines</span>(x_vals, <span class="fu">rayleigh_pdf</span>(x_vals, sigma), <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-3.11" class="section level2">
<h2>Question 3.11</h2>
<p>Generate a random sample of size 1000 from a normal location
mixture.Repeat with different values for p1 and observe whether the
empirical distribution of the mixture appears to be bimodal. Make a
conjecture about the values of p1 that produce bimodal mixtures.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>answer_3_11 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p1, mean1, sd1, mean2, sd2){</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="co"># 根据p1, 1-p1的概率混合两个正态分布</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  mixing_prob <span class="ot">&lt;-</span> p1</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  choices <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  mixing_samples <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(choices <span class="sc">&lt;</span> mixing_prob, <span class="fu">rnorm</span>(n, mean1, sd1), </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>      <span class="fu">rnorm</span>(n, mean2, sd2))</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="co"># 绘制混合分布随机样本的直方图</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="fu">hist</span>(mixing_samples, <span class="at">prob =</span> <span class="cn">TRUE</span>, <span class="at">breaks =</span> <span class="dv">40</span>, <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>, </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>      <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;Mixing Probability (p1 =&quot;</span>, p1, <span class="st">&quot;)&quot;</span>))</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-3.20" class="section level2">
<h2>Question 3.20</h2>
<p>Write a program to simulate a compound Poisson(λ)–Gamma process (Y
has a Gamma distribution). Estimate the mean and the variance of X(10)
for several choices of the parameters and compare with the theoretical
values.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>answer_3_20 <span class="ot">&lt;-</span> <span class="cf">function</span>(t, lambda, alpha, beta){</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="co"># 定义模拟复合泊松-伽马过程的函数</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  simulate_compound_poisson_gamma <span class="ot">&lt;-</span> <span class="cf">function</span>(t, lambda, alpha, beta) {</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    N_t <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda <span class="sc">*</span> t)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="cf">if</span> (N_t <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>      <span class="fu">return</span>(<span class="dv">0</span>) <span class="co"># 返回X(t) = 0</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>      Y_i <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(N_t, alpha, beta)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sum</span>(Y_i)) <span class="co"># 返回复合泊松-伽马过程过程X(t)</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    }</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  }</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="co"># 模拟1000次得到复合泊松-伽马过程{X(t), t ≥ 0}, 计算结果</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  X_t <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">1000</span>, <span class="fu">simulate_compound_poisson_gamma</span>(t, lambda, alpha, beta))</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  mean_estimated <span class="ot">&lt;-</span> <span class="fu">mean</span>(X_t)</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  var_estimated <span class="ot">&lt;-</span> <span class="fu">var</span>(X_t)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  mean_theoretical <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> alpha <span class="sc">/</span> beta</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>  var_theoretical <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> alpha <span class="sc">*</span> (alpha <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (beta<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="co"># 输出均值和方差的估计值和理论值</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Estimated Mean of X(10):&quot;</span>, mean_estimated,</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>      <span class="st">&quot;Estimated Variance of X(10):&quot;</span>, var_estimated, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Theoretical Mean of X(10):&quot;</span>, mean_theoretical,</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>      <span class="st">&quot;Theoretical Variance of X(10):&quot;</span>, var_theoretical, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-5.4" class="section level2">
<h2>Question 5.4</h2>
<p>Write a function to compute a Monte Carlo estimate of the Beta(3, 3)
cdf, and use the function to estimate F(x) for x = 0.1, 0.2, . . . ,
0.9. Compare the estimates with the values returned by the pbeta
function in R.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>answer_5_4 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, alpha, beta){</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  x_vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="co"># 计算蒙特卡洛估计、pbeta的F(x)值</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  monte_carlo_cdf <span class="ot">&lt;-</span> <span class="fu">sapply</span>(x_vals, <span class="cf">function</span>(x){</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    uniform_samples <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, x)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">dbeta</span>(uniform_samples, alpha, beta)) <span class="sc">*</span> x</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  })</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  pbeta_cdf <span class="ot">&lt;-</span> <span class="fu">pbeta</span>(x_vals, alpha, beta)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    <span class="at">x =</span> x_vals,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="at">MonteCarloCDF =</span> monte_carlo_cdf,</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="at">PbetaCDF =</span> pbeta_cdf,</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    <span class="at">Difference =</span> <span class="fu">abs</span>(monte_carlo_cdf <span class="sc">-</span> pbeta_cdf))</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="fu">print</span>(result)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-5.9" class="section level2">
<h2>Question 5.9</h2>
<p>Implement a function to generate samples from a Rayleigh(σ)
distribution, using antithetic variables. What is the percent reduction
in variance of (X+X′)/2 compared with (X1+X2)/2 for independent X1,
X2?</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>answer_5_9 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, sigma){</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="co"># 使用逆变换法生成对偶随机数、两个独立的随机数</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  X <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(u))</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  X_duiou <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> u))</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  X1 <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">runif</span>(n)))</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  X2 <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">runif</span>(n)))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="co"># 输出结果比较(X+X′)/2、(X1+X2)/2的方差</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  var_anti <span class="ot">&lt;-</span> <span class="fu">var</span>((X <span class="sc">+</span> X_duiou) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  var_ind <span class="ot">&lt;-</span> <span class="fu">var</span>((X1 <span class="sc">+</span> X2) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Variance of (X + X&#39;) / 2 : &quot;</span>, var_anti,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>      <span class="st">&quot;Variance of (X1 + X2) / 2 : &quot;</span>, var_ind,</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>      <span class="st">&quot;percent reduction: &quot;</span>, <span class="fu">abs</span>(var_anti <span class="sc">-</span> var_ind) <span class="sc">/</span> var_ind, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-5.13" class="section level2">
<h2>Question 5.13</h2>
<p>Find two importance functions f1 and f2 that are supported on (1, ∞)
and are ‘close’ to g(x), Which of your two importance functions should
produce the smaller variance in estimating by importance sampling?
Explain.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>answer_5_13 <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="co"># 定义g(x)函数</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  }</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="co"># f1, f2分别选择Exp(1), Ga(3, 1)，且均向右移动一个单位长度</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  f1_samples <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  f1_estimate <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">g</span>(f1_samples) <span class="sc">/</span> <span class="fu">dexp</span>(f1_samples <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  f1_var <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">g</span>(f1_samples) <span class="sc">/</span> <span class="fu">dexp</span>(f1_samples <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">/</span> n</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  f2_samples <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, <span class="dv">3</span>, <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  f2_estimate <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">g</span>(f2_samples) <span class="sc">/</span> <span class="fu">dgamma</span>(f2_samples <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>  f2_var <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">g</span>(f2_samples) <span class="sc">/</span> <span class="fu">dgamma</span>(f2_samples <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)) <span class="sc">/</span> n</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>  <span class="co"># 输出结果比较使用Exp(1), Ga(3, 1)的方差</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Estimate using Exp(1):&quot;</span>, f1_estimate, </span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>      <span class="st">&quot;Variance using Exp(1):&quot;</span>, f1_var, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Estimate using Ga(3, 1):&quot;</span>, f2_estimate, </span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>      <span class="st">&quot;Variance using Ga(3, 1):&quot;</span>, f2_var, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  <span class="co"># 作出g(x)、f1、f2的函数图像</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>  x_vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">1000</span>)</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>  <span class="fu">plot</span>(x_vals, <span class="fu">g</span>(x_vals), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(<span class="fu">g</span>(x_vals), <span class="fu">dexp</span>(x_vals<span class="dv">-1</span>,<span class="dv">1</span>), <span class="fu">dgamma</span>(x_vals<span class="dv">-1</span>,<span class="dv">3</span>,<span class="dv">1</span>))), </span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>)</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>  <span class="fu">lines</span>(x_vals, <span class="fu">dexp</span>(x_vals <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>  <span class="fu">lines</span>(x_vals, <span class="fu">dgamma</span>(x_vals <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="at">col =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;pink&quot;</span>), <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>         <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;g(x)&quot;</span>, <span class="st">&quot;f1&quot;</span>, <span class="st">&quot;f2&quot;</span>))</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question" class="section level2">
<h2>Question</h2>
<p>For n=10<sup>4,2×10</sup>4,4×10<sup>4,6×10</sup>4,8×10^4,apply the
fast sorting algorithm to randomly permuted numbers of 1, . . . , n.
Calculate computation time averaged over 100 simulations, denoted by an.
Regress an on tn := n log(n), and graphically show the results (scatter
plot and regression line).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>fast_sorting_experiment <span class="ot">&lt;-</span> <span class="cf">function</span>(n_values){</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  fast_sort <span class="ot">&lt;-</span> <span class="cf">function</span>(arr){</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="co"># 递归终止条件：如果数组长度不大于1则返回该数组</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(arr) <span class="sc">&lt;=</span> <span class="dv">1</span>) {</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>      <span class="fu">return</span>(arr)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>      <span class="co"># 随机选择一个基准数，以此划分数组</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>      pivot <span class="ot">&lt;-</span> arr[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(arr), <span class="dv">1</span>)]</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>      equal <span class="ot">&lt;-</span> arr[arr <span class="sc">==</span> pivot]</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>      left_sorted <span class="ot">&lt;-</span> <span class="fu">fast_sort</span>(arr[arr <span class="sc">&lt;</span> pivot])</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>      right_sorted <span class="ot">&lt;-</span> <span class="fu">fast_sort</span>(arr[arr <span class="sc">&gt;</span> pivot])</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>      <span class="co"># 返回递归结果</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(left_sorted, equal,right_sorted))</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>      }</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  }</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="co"># a_n用来储存平均计算时间，嵌套循环得到不同n的平均时间</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>  a_n <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(n_values))</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(n_values)){</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    times <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>      times[j] <span class="ot">&lt;-</span> <span class="fu">system.time</span>(<span class="fu">fast_sort</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n_values[i])))[<span class="dv">3</span>]</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    }</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>    a_n[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(times)</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>  }</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>  <span class="co"># 回归分析画图</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>  t_n <span class="ot">&lt;-</span> n_values <span class="sc">*</span> <span class="fu">log</span>(n_values)</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(a_n <span class="sc">~</span> t_n)</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>  <span class="fu">plot</span>(t_n, a_n, <span class="at">xlab =</span> <span class="st">&quot;tn=nlog(n)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;an&quot;</span>)</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>  <span class="fu">abline</span>(model, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-6.6" class="section level2">
<h2>Question 6.6</h2>
<p>Estimate the 0.025, 0.05, 0.95, and 0.975 quantiles of the skewness
√b1 under normality by a Monte Carlo experiment. Compute the standard
error of the estimates from 2.14 using the normal approximation for the
density (with exact variance formula). Compare the estimated quantiles
with the quantiles of the large sample approximation √b1 ≈ N (0,
6/n).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>answer_6_6 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, num_sim) {</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="co"># 生成数据返回偏度</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  data_generation <span class="ot">&lt;-</span> <span class="cf">function</span>(n, num_sim) {</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    skewness <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_sim)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_sim) {</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>      sample_data <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>      m3 <span class="ot">&lt;-</span> <span class="fu">mean</span>((sample_data <span class="sc">-</span> <span class="fu">mean</span>(sample_data))<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>      m2 <span class="ot">&lt;-</span> <span class="fu">mean</span>((sample_data <span class="sc">-</span> <span class="fu">mean</span>(sample_data))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>      skewness[i] <span class="ot">&lt;-</span> m3 <span class="sc">/</span> m2<span class="sc">^</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    }</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    <span class="fu">return</span>(skewness)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  }</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  <span class="co"># 计算偏度分位数的蒙特卡洛估计量</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  stat_inference <span class="ot">&lt;-</span> <span class="cf">function</span>(skewness) {</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>    quantiles_mc <span class="ot">&lt;-</span> <span class="fu">quantile</span>(skewness, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span>))</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>    se <span class="ot">&lt;-</span> <span class="fu">sd</span>(skewness) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(skewness))</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">quantiles_mc =</span> quantiles_mc, <span class="at">se =</span> se))</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>  }</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="co"># 计算偏度在大样本下近似分布的分位数，进行结果比较</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>  result_report <span class="ot">&lt;-</span> <span class="cf">function</span>(quantiles_mc, n) {</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>    quantiles_ls <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span>), </span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>                              <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">6</span><span class="sc">/</span>n))</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>      <span class="st">&quot;Quantiles&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span>),</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>      <span class="st">&quot;Monte Carlo Estimate&quot;</span> <span class="ot">=</span> quantiles_mc,</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>      <span class="st">&quot;Large Sample Approx&quot;</span> <span class="ot">=</span> quantiles_ls)</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>    <span class="fu">print</span>(result)</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>  }</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>  <span class="co"># 调用函数输出结果</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>  skewness <span class="ot">&lt;-</span> <span class="fu">data_generation</span>(n, num_sim)</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>  quantiles_mc <span class="ot">&lt;-</span> <span class="fu">stat_inference</span>(skewness)<span class="sc">$</span>quantiles_mc</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>  <span class="fu">result_report</span>(quantiles_mc, n)</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-6.b" class="section level2">
<h2>Question 6.B</h2>
<p>Tests for association based on Pearson product moment correlation ρ,
Spearman’s rank correlation coefficient ρs, or Kendall’s coefficient τ,
are implemented in cor.test. Show (empirically) that the nonparametric
tests based on ρs or τ are less powerful than the correlation test when
the sampled distribution is bivariate normal. Find an example of an
alternative (a bivariate distribution (X, Y) such that X and Y are
dependent) such that at least one of the nonparametric tests have better
empirical power than the correlation test against this alternative.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>answer_6_b <span class="ot">&lt;-</span> <span class="cf">function</span>(n, num_sim, rho, alpha) {</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="co"># (X, Y)分别是多元正态分布、多项式依赖关系</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  bivariate_generation <span class="ot">&lt;-</span> <span class="cf">function</span>(n, rho, dist_type) {</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="cf">if</span> (dist_type <span class="sc">==</span> <span class="st">&quot;ind&quot;</span>) {</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>      Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>      data <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> Sigma)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (dist_type <span class="sc">==</span> <span class="st">&quot;d&quot;</span>) {</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>      X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>      Y <span class="ot">&lt;-</span> X<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> X <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>      data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X, Y)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    }</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    <span class="fu">return</span>(data)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>  }</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  <span class="co"># 使用cor.test()计算Pearson, Spearman, Kendall检验的p-value</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  cor_test <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>    pearson_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(data[, <span class="dv">1</span>], data[, <span class="dv">2</span>], <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>    spearman_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(data[, <span class="dv">1</span>], data[, <span class="dv">2</span>], <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>    kendall_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(data[, <span class="dv">1</span>], data[, <span class="dv">2</span>], <span class="at">method =</span> <span class="st">&quot;kendall&quot;</span>)</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>      <span class="at">pearson_pval =</span> pearson_test<span class="sc">$</span>p.value,</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>      <span class="at">spearman_pval =</span> spearman_test<span class="sc">$</span>p.value,</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>      <span class="at">kendall_pval =</span> kendall_test<span class="sc">$</span>p.value))</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>  }</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>  <span class="co"># 通过num_sim次实验得到的p-value计算不同检验的power</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>  power_empir <span class="ot">&lt;-</span> <span class="cf">function</span>(n, num_sim, rho, alpha, dist_type) {</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>    data_xy <span class="ot">&lt;-</span> <span class="fu">replicate</span>(num_sim, <span class="fu">bivariate_generation</span>(n, rho, dist_type), <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>    pearson_result <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data_xy, <span class="cf">function</span>(x) <span class="fu">cor_test</span>(x)<span class="sc">$</span>pearson_pval <span class="sc">&lt;=</span> alpha)</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>    spearman_result <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data_xy, <span class="cf">function</span>(x) <span class="fu">cor_test</span>(x)<span class="sc">$</span>spearman_pval <span class="sc">&lt;=</span> alpha)</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>    kendall_result <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data_xy, <span class="cf">function</span>(x) <span class="fu">cor_test</span>(x)<span class="sc">$</span>kendall_pval <span class="sc">&lt;=</span> alpha)</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>        <span class="at">pearson_power =</span> <span class="fu">mean</span>(pearson_result),</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>        <span class="at">spearman_power =</span> <span class="fu">mean</span>(spearman_result),</span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>        <span class="at">kendall_power =</span> <span class="fu">mean</span>(kendall_result)))</span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>  }</span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>  <span class="co"># 调用函数输出结果</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>  ind_power <span class="ot">&lt;-</span> <span class="fu">power_empir</span>(n, num_sim, rho, alpha, <span class="at">dist_type =</span> <span class="st">&quot;ind&quot;</span>)</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>  d_power <span class="ot">&lt;-</span> <span class="fu">power_empir</span>(n, num_sim, rho, alpha, <span class="at">dist_type =</span> <span class="st">&quot;d&quot;</span>)</span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;normal power : &quot;</span>, ind_power, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;alternative power : &quot;</span>, d_power, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-1" class="section level2">
<h2>Question</h2>
<p>If we obtain the powers for two methods under a particular simulation
setting with 10,000 experiments: say, 0.651 for one method and 0.676 for
another method. We want to know if the powers are different at 0.05
level. What is the corresponding hypothesis test problem? What test
should we use? Z-test, two-sample t-test, paired-t test or McNemar test?
Why? Please provide the least necessary information for hypothesis
testing.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>hypothesis_test <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p1, p2) {</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  method1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, p1)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  method2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, p2)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  paired_t_result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(method1, method2, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">print</span>(paired_t_result)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-2" class="section level2">
<h2>Question</h2>
<p>Of N = 1000 hypotheses, 950 are null and 50 are alternative. The
p-value under any null hypothesis is uniformly distributed (use runif),
and the p-value under any alternative hypothesis follows the beta
distribution with parameter 0.1 and 1 (use rbeta). Obtain Bonferroni
adjusted p-values and B-H adjusted p-values. Calculate FWER, FDR, and
TPR under nominal level α = 0.1 for each of the two adjustment methods
based on m = 10000 simulation replicates. You should output the 6
numbers (3 ) to a 3 × 2 table (column names: Bonferroni correction, B-H
correction; row names: FWER, FDR, TPR). Comment the results.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>multiple_test_problem <span class="ot">&lt;-</span> <span class="cf">function</span>(N, n_null, alpha, m) {</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  results_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> m, <span class="at">ncol =</span> <span class="dv">6</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    pvals_null <span class="ot">&lt;-</span> <span class="fu">runif</span>(n_null)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    pvals_alt <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(N <span class="sc">-</span> n_null, <span class="fl">0.1</span>, <span class="dv">1</span>)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    pvals <span class="ot">&lt;-</span> <span class="fu">c</span>(pvals_null, pvals_alt)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    true_status <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, n_null), <span class="fu">rep</span>(<span class="dv">1</span>, N <span class="sc">-</span> n_null))</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="co"># 计算Bonferroni correction的FWER, FDR, TPR</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    pval_bonferroni <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(pvals, <span class="at">method =</span> <span class="st">&quot;bonferroni&quot;</span>)</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    reject_bonferroni <span class="ot">&lt;-</span> pval_bonferroni <span class="sc">&lt;</span> alpha</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    FWER_bonferroni <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_bonferroni <span class="sc">&amp;</span> true_status <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    FDR_bonferroni <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_bonferroni <span class="sc">&amp;</span> true_status <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">sum</span>(reject_bonferroni))</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>    TPR_bonferroni <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_bonferroni <span class="sc">&amp;</span> true_status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="fu">sum</span>(true_status <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    <span class="co"># 计算B-H correction的FWER, FDR, TPR</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    pval_bh <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(pvals, <span class="at">method =</span> <span class="st">&quot;BH&quot;</span>)</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    reject_bh <span class="ot">&lt;-</span> pval_bh <span class="sc">&lt;</span> alpha</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>    FWER_bh <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_bh <span class="sc">&amp;</span> true_status <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>    FDR_bh <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_bh <span class="sc">&amp;</span> true_status <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">sum</span>(reject_bh))</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>    TPR_bh <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_bh <span class="sc">&amp;</span> true_status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="fu">sum</span>(true_status <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>    results_matrix[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(FWER_bonferroni, FDR_bonferroni, TPR_bonferroni,</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>                             FWER_bh, FDR_bh, TPR_bh)</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>  }</span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>  <span class="co"># 将每轮结果处理成3 × 2 table</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>  avg_results <span class="ot">&lt;-</span> <span class="fu">apply</span>(results_matrix, <span class="dv">2</span>, mean)</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>  output_table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(avg_results, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>                         <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;FWER&quot;</span>, <span class="st">&quot;FDR&quot;</span>, <span class="st">&quot;TPR&quot;</span>),</span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>                                         <span class="fu">c</span>(<span class="st">&quot;Bonferroni correction&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>)))</span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>  <span class="fu">print</span>(output_table)</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-7.4" class="section level2">
<h2>Question 7.4</h2>
<p>Refer to the air-conditioning data set aircondit provided in the boot
package. The 12 observations are the times in hours between failures of
air- conditioning equipment [63, Example 1.1]: 3, 5, 7, 18, 43, 85, 91,
98, 100, 130, 230, 487. Assume that the times between failures follow an
exponential model Exp(λ). Obtain the MLE of the hazard rate λ and use
bootstrap to estimate the bias and standard error of the estimate.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>answer_7_4 <span class="ot">&lt;-</span> <span class="cf">function</span>(R) {</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">43</span>, <span class="dv">85</span>, <span class="dv">91</span>, <span class="dv">98</span>, <span class="dv">100</span>, <span class="dv">130</span>, <span class="dv">230</span>, <span class="dv">487</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  lambda_mle <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">mean</span>(data)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="co"># 定义计算MLE的函数</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  mle_lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices) {</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    sample_data <span class="ot">&lt;-</span> data[indices]</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">mean</span>(sample_data))</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  }</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="co"># 进行bootstrap得到bias and standard error</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  boot_lambda <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot</span>(data, mle_lambda, R)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  boot_bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(boot_lambda<span class="sc">$</span>t) <span class="sc">-</span> lambda_mle</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>  boot_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(boot_lambda<span class="sc">$</span>t)</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="co"># 打印结果</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;MLE of the hazard rate λ :&quot;</span>, lambda_mle, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>      <span class="st">&quot;bootstrap bias :&quot;</span>, boot_bias, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>      <span class="st">&quot;bootstrap standard error :&quot;</span>, boot_se, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-7.5" class="section level2">
<h2>Question 7.5</h2>
<p>Refer to Exercise 7.4. Compute 95% bootstrap confidence intervals for
the mean time between failures 1/λ by the standard normal, basic,
percentile, and BCa methods. Compare the intervals and explain why they
may differ.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>answer_7_5 <span class="ot">&lt;-</span> <span class="cf">function</span>(R) {</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">43</span>, <span class="dv">85</span>, <span class="dv">91</span>, <span class="dv">98</span>, <span class="dv">100</span>, <span class="dv">130</span>, <span class="dv">230</span>, <span class="dv">487</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="co"># 定义计算mean time的函数</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  mean_time <span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices) {</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    sample_data <span class="ot">&lt;-</span> data[indices]</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">mean</span>(sample_data))</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  }</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="co"># 进行bootstrap得到standard normal, basic, percentile, and BCa methods的CI</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  boot_time <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot</span>(data, mean_time, R)</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  ci_normal <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot.ci</span>(boot_time, <span class="at">type =</span> <span class="st">&quot;norm&quot;</span>)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  ci_basic <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot.ci</span>(boot_time, <span class="at">type =</span> <span class="st">&quot;basic&quot;</span>)</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  ci_percentile <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot.ci</span>(boot_time, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>)</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>  ci_bca <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot.ci</span>(boot_time, <span class="at">type =</span> <span class="st">&quot;bca&quot;</span>)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  <span class="co"># 打印结果</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Standard normal method: &quot;</span>, ci_normal<span class="sc">$</span>normal[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>      <span class="st">&quot;Basic method: &quot;</span>, ci_basic<span class="sc">$</span>basic[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>      <span class="st">&quot;Percentile method: &quot;</span>, ci_percentile<span class="sc">$</span>perc[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>      <span class="st">&quot;BCa method: &quot;</span>, ci_bca<span class="sc">$</span>bca[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-7.8" class="section level1">
<h1>Question 7.8</h1>
<p>Refer to Exercise 7.7. Obtain the jackknife estimates of bias and
standard error of θˆ.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>answer_7_8 <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  scor <span class="ot">&lt;-</span> bootstrap<span class="sc">::</span>scor</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="co"># 定义计算参数θ的函数</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  theta <span class="ot">&lt;-</span> <span class="cf">function</span>(x, i) {</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> <span class="fu">eigen</span>(<span class="fu">cov</span>(x[i,]))<span class="sc">$</span>values</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    <span class="fu">return</span> (lambda[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(lambda))</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  }</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(scor)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>  theta_hat <span class="ot">&lt;-</span> <span class="fu">theta</span>(scor, <span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>  <span class="co"># 通过刀切法得到估计的偏差和标准差</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  theta_jack <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>    theta_jack[i] <span class="ot">&lt;-</span> <span class="fu">theta</span>(scor, (<span class="dv">1</span><span class="sc">:</span>n)[<span class="sc">-</span>i]) }</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  bias_jack <span class="ot">&lt;-</span> (n<span class="dv">-1</span>)<span class="sc">*</span>(<span class="fu">mean</span>(theta_jack)<span class="sc">-</span>theta_hat)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  se_jack <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((n<span class="dv">-1</span>)<span class="sc">*</span><span class="fu">mean</span>((theta_jack<span class="sc">-</span>theta_hat)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;bias:&quot;</span>, <span class="fu">round</span>(bias_jack, k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>      <span class="st">&quot;standard error:&quot;</span>, <span class="fu">round</span>(se_jack, k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-7.10" class="section level1">
<h1>Question 7.10</h1>
<p>In Example 7.18, leave-one-out (n-fold) cross validation was used to
select the best fitting model. Repeat the analysis replacing the Log-Log
model with a cubic polynomial model. Which of the four models is
selected by the cross validation procedure? Which model is selected
according to maximum adjusted R2?</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>answer_7_10 <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="co"># 加载数据并定义四种模型的函数</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  ironslag <span class="ot">&lt;-</span> DAAG<span class="sc">::</span>ironslag</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  X <span class="ot">&lt;-</span> ironslag<span class="sc">$</span>chemical</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> ironslag<span class="sc">$</span>magnetic</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  linear <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y) { <span class="fu">lm</span>(Y <span class="sc">~</span> X) }</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  quadratic <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y) { <span class="fu">lm</span>(Y <span class="sc">~</span> <span class="fu">poly</span>(X, <span class="dv">2</span>)) }</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  exponential <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y) { <span class="fu">lm</span>(<span class="fu">log</span>(Y) <span class="sc">~</span> X) }</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  cubic <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y) { <span class="fu">lm</span>(Y <span class="sc">~</span> <span class="fu">poly</span>(X, <span class="dv">3</span>)) }</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(Y)</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  <span class="co"># 定义计算loocv error的函数</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>  loocv_error <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>    error <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>      fit <span class="ot">&lt;-</span> <span class="fu">model</span>(X[<span class="sc">-</span>i], Y[<span class="sc">-</span>i])</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>      prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">X =</span> X[i]))</span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>      error[i] <span class="ot">&lt;-</span> (Y[i] <span class="sc">-</span> prediction)<span class="sc">^</span><span class="dv">2</span> }</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>    <span class="fu">return</span> (<span class="fu">mean</span>(error))</span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>  }</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>  <span class="co"># 定义计算adjusted R2的函数</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>  adjusted_R2 <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">summary</span>(model)<span class="sc">$</span>adj.r.squared)</span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>  }</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;linear loocv error:&quot;</span>, <span class="fu">round</span>(<span class="fu">loocv_error</span>(linear), k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>      <span class="st">&quot;quadratic loocv error:&quot;</span>, <span class="fu">round</span>(<span class="fu">loocv_error</span>(quadratic), k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>      <span class="st">&quot;exponential loocv error:&quot;</span>, <span class="fu">round</span>(<span class="fu">loocv_error</span>(exponential), k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>      <span class="st">&quot;cubic loocv error:&quot;</span>, <span class="fu">round</span>(<span class="fu">loocv_error</span>(cubic), k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;linear adjusted R2:&quot;</span>, <span class="fu">round</span>(<span class="fu">adjusted_R2</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> X)), k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a>      <span class="st">&quot;quadratic adjusted R2:&quot;</span>, <span class="fu">round</span>(<span class="fu">adjusted_R2</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> <span class="fu">poly</span>(X, <span class="dv">2</span>))), k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>      <span class="st">&quot;exponential adjusted R2:&quot;</span>, <span class="fu">round</span>(<span class="fu">adjusted_R2</span>(<span class="fu">lm</span>(<span class="fu">log</span>(Y) <span class="sc">~</span> X)), k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a>      <span class="st">&quot;cubic adjusted R2:&quot;</span>, <span class="fu">round</span>(<span class="fu">adjusted_R2</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> <span class="fu">poly</span>(X, <span class="dv">3</span>))), k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-33"><a href="#cb15-33" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-8.1" class="section level1">
<h1>Question 8.1</h1>
<p>Implement the two-sample Cram ́er-von Mises test for equal
distributions as a permutation test. Apply the test to the data in
Examples 8.1 and 8.2.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>answer_8_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(num_perm) {</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">158</span>, <span class="dv">171</span>, <span class="dv">193</span>, <span class="dv">199</span>, <span class="dv">230</span>, <span class="dv">243</span>, <span class="dv">248</span>, <span class="dv">248</span>, <span class="dv">250</span>, <span class="dv">267</span>, <span class="dv">271</span>, <span class="dv">316</span>, <span class="dv">327</span>, <span class="dv">329</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">141</span>, <span class="dv">148</span>, <span class="dv">169</span>, <span class="dv">181</span>, <span class="dv">203</span>, <span class="dv">213</span>, <span class="dv">229</span>, <span class="dv">244</span>, <span class="dv">257</span>, <span class="dv">260</span>, <span class="dv">271</span>, <span class="dv">309</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  cram_test <span class="ot">&lt;-</span> cramer<span class="sc">::</span><span class="fu">cramer.test</span>(X, Y)<span class="sc">$</span>statistic</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="co"># 定义permutation test的函数</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  perm_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, num_perm) {</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    perm <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_perm)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_perm) {</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>      j <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">c</span>(x, y)), <span class="at">size =</span> <span class="fu">length</span>(x), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>      perm_x <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)[j]</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>      perm_y <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)[<span class="sc">-</span>j]</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>      perm[i] <span class="ot">&lt;-</span> cramer<span class="sc">::</span><span class="fu">cramer.test</span>(perm_x, perm_y)<span class="sc">$</span>statistic }</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    <span class="fu">return</span> (<span class="fu">mean</span>(<span class="fu">c</span>(cram_test, perm) <span class="sc">&gt;=</span> cram_test))</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>  }</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> <span class="fu">perm_test</span>(X, Y, num_perm)</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Cramer-von Mises test p-value:&quot;</span>, cramer<span class="sc">::</span><span class="fu">cramer.test</span>(X, Y)<span class="sc">$</span>p.value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>      <span class="st">&quot;permutation test p-value:&quot;</span>, p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-8.2" class="section level1">
<h1>Question 8.2</h1>
<p>Implement the bivariate Spearman rank correlation test for
independence [255] as a permutation test. The Spearman rank correlation
test statistic can be obtained from function cor with method =
“spearman”. Compare the achieved significance level of the permutation
test with the p-value reported by cor.test on the same samples.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>answer_8_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(num_perm) {</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="co"># (X, Y)是独立的标准正态分布</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  cor_init <span class="ot">&lt;-</span> <span class="fu">cor</span>(X, Y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="co"># 定义permutation test的函数</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  perm_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, num_perm) {</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>    perm <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_perm)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_perm) {</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>      j <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">c</span>(x, y)), <span class="at">size =</span> <span class="fu">length</span>(x), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>      perm_x <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)[j]</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>      perm_y <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)[<span class="sc">-</span>j]</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>      perm[i] <span class="ot">&lt;-</span> <span class="fu">cor</span>(perm_x, perm_y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) }</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>    <span class="fu">return</span> (<span class="fu">mean</span>(<span class="fu">c</span>(cor_init, perm) <span class="sc">&gt;=</span> cor_init))</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>  }</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> <span class="fu">perm_test</span>(X, Y, num_perm)</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;permutation test p-value:&quot;</span>, p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>  <span class="fu">cor.test</span>(X, Y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>}</span></code></pre></div>
<div id="question-9.3" class="section level2">
<h2>Question 9.3</h2>
<p>Use the Metropolis-Hastings sampler to generate random variables from
a standard Cauchy distribution. Discard the first 1000 of the chain, and
com- pare the deciles of the generated observations with the deciles of
the standard Cauchy distribution (see qcauchy or qt with df=1). Recall
that a Cauchy(θ, η) distribution has density function f(x) = 1/θπ(1 +
[(x − η)/θ]^2), −∞ &lt; x &lt; ∞, θ &gt; 0. The standard Cauchy has the
Cauchy(θ = 1, η = 0) density. (Note that the standard Cauchy density is
equal to the Student t density with one degree of freedom.)</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>answer_9_3 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, discard) {</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="co"># 初始化</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  samples[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="co"># Metropolis-Hastings采样</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>    proposal <span class="ot">&lt;-</span> samples[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>    acceptance_ratio <span class="ot">&lt;-</span> <span class="fu">dcauchy</span>(proposal) <span class="sc">/</span> <span class="fu">dcauchy</span>(samples[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> acceptance_ratio) {</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>      samples[i] <span class="ot">&lt;-</span> proposal</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>    } <span class="cf">else</span> { samples[i] <span class="ot">&lt;-</span> samples[i <span class="sc">-</span> <span class="dv">1</span>] }</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  }</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>  <span class="co"># 计算样本分位数和标准Cauchy分位数</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> samples[(discard <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n]</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  sample_deciles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(samples, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  theoretical_deciles <span class="ot">&lt;-</span> <span class="fu">qcauchy</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;deciles of generated observations:&quot;</span>, sample_deciles, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;deciles of standard Cauchy distribution:&quot;</span>, theoretical_deciles, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-9.8" class="section level2">
<h2>Question 9.8</h2>
<p>This example appears in [40]. Consider the bivariate density f(x,y)∝
(n x) y<sup>(x+a−1)(1−y)</sup>(n−x+b−1), x=0,1,…,n, 0≤y≤1. It can be
shown (see e.g. [23]) that for fixed a, b, n, the conditional
distributions are Binomial(n, y) and Beta(x + a, n − x + b). Use the
Gibbs sampler to generate a chain with target joint density f(x,y).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>answer_9_8 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, discard, a, b, n_val) {</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="co"># 初始化</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  x_samples <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  y_samples <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  x_samples[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  y_samples[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="co"># Gibbs采样</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>    <span class="co"># 更新x的条件分布Binomial(n, y)</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>    y_current <span class="ot">&lt;-</span> y_samples[i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>    x_samples[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> n_val, <span class="at">prob =</span> y_current)</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>    <span class="co"># 更新y的条件分布Beta(x + a, n − x + b)</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    x_current <span class="ot">&lt;-</span> x_samples[i]</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>    y_samples[i] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="at">shape1 =</span> x_current <span class="sc">+</span> a, <span class="at">shape2 =</span> n_val <span class="sc">-</span> x_current <span class="sc">+</span> b)</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  }</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>  <span class="co"># 绘制联合分布图</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>  <span class="fu">plot</span>(x_samples[(discard <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n], y_samples[(discard <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n], <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">&quot;joint density f(x,y)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>)</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-3" class="section level2">
<h2>Question</h2>
<p>For each of the above exercise, use the Gelman-Rubin method to
monitor convergence of the chain, and run the chain until it converges
approximately to the target distribution according to Rˆ &lt; 1.2.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>converge_9_3 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, discard, n_chain) {</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="co"># 初始化</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  chains <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> n_chain)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="co"># 运行多条马尔可夫链</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_chain) {</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>    chain <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>    chain[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>      proposal <span class="ot">&lt;-</span> chain[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>      acceptance_ratio <span class="ot">&lt;-</span> <span class="fu">dcauchy</span>(proposal) <span class="sc">/</span> <span class="fu">dcauchy</span>(chain[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> acceptance_ratio) {</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>        chain[i] <span class="ot">&lt;-</span> proposal</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>      } <span class="cf">else</span> { chain[i] <span class="ot">&lt;-</span> chain[i <span class="sc">-</span> <span class="dv">1</span>] }</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>    }</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>    chains[, j] <span class="ot">&lt;-</span> chain</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>  }</span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>  <span class="co"># 转换为mcmc.list对象</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>  mcmc_chains <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc.list</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>n_chain, <span class="cf">function</span>(j) <span class="fu">mcmc</span>(chains[(discard <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n, j])))</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>  <span class="co"># Gelman-Rubin收敛诊断</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>  gelman_diag <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">gelman.diag</span>(mcmc_chains)<span class="sc">$</span>psrf[, <span class="st">&quot;Point est.&quot;</span>]</span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;convergence of chains:&quot;</span>, gelman_diag, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>converge_9_8 <span class="ot">&lt;-</span> <span class="cf">function</span>(n, discard, a, b, n_val, n_chain) {</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="co"># 初始化</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  x_chains <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> n_chain)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  y_chains <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> n_chain)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="co"># 运行多条马尔可夫链</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_chain) {</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    x_chain <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>    y_chain <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>    x_chain[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>    y_chain[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>      y_current <span class="ot">&lt;-</span> y_chain[i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>      x_chain[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> n_val, <span class="at">prob =</span> y_current)</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>      x_current <span class="ot">&lt;-</span> x_chain[i]</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>      y_chain[i] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="at">shape1 =</span> x_current <span class="sc">+</span> a, <span class="at">shape2 =</span> n_val <span class="sc">-</span> x_current <span class="sc">+</span> b)</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>    }</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>    x_chains[, j] <span class="ot">&lt;-</span> x_chain</span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>    y_chains[, j] <span class="ot">&lt;-</span> y_chain</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>  }</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>  <span class="co"># 转换为mcmc.list对象</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>  x_mcmc_chains <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc.list</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>n_chain, <span class="cf">function</span>(j) <span class="fu">mcmc</span>(x_chains[(discard <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n, j])))</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a>  y_mcmc_chains <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc.list</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>n_chain, <span class="cf">function</span>(j) <span class="fu">mcmc</span>(y_chains[(discard <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n, j])))</span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a>  <span class="co"># Gelman-Rubin收敛诊断</span></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a>  gelman_diag_x <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">gelman.diag</span>(x_mcmc_chains)<span class="sc">$</span>psrf[, <span class="st">&quot;Point est.&quot;</span>]</span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a>  gelman_diag_y <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">gelman.diag</span>(y_mcmc_chains)<span class="sc">$</span>psrf[, <span class="st">&quot;Point est.&quot;</span>]</span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;convergence of x_chains:&quot;</span>, gelman_diag_x, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;convergence of y_chains:&quot;</span>, gelman_diag_y, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-11.3" class="section level2">
<h2>Question 11.3</h2>
<ol style="list-style-type: lower-alpha">
<li>Write a function to compute the kth term in where d ≥ 1 is an
integer, a is a vector in Rd, and ∥ · ∥ denotes the Euclidean norm.
Perform the arithmetic so that the coefficients can be computed for
(almost) arbitrarily large k and d. (This sum converges for all a ∈
Rd).</li>
<li>Modify the function so that it computes and returns the sum.</li>
<li>Evaluate the sum when a = (1, 2).</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>answer_11_3 <span class="ot">&lt;-</span> <span class="cf">function</span>(a, d, max_k) {</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="co"># compute the kth term</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  compute_term <span class="ot">&lt;-</span> <span class="cf">function</span>(a, d, k) {</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>    norm_a <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(a<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>    term <span class="ot">&lt;-</span> ((<span class="sc">-</span><span class="dv">1</span>)<span class="sc">^</span>k <span class="sc">/</span> (<span class="fu">factorial</span>(k) <span class="sc">*</span> <span class="dv">2</span><span class="sc">^</span>k)) <span class="sc">*</span> </span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>          (norm_a<span class="sc">^</span>(<span class="dv">2</span> <span class="sc">*</span> k <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> ((<span class="dv">2</span> <span class="sc">*</span> k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">*</span> k <span class="sc">+</span> <span class="dv">2</span>))) <span class="sc">*</span> </span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>          (<span class="fu">gamma</span>((d <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">gamma</span>(k <span class="sc">+</span> <span class="dv">3</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">gamma</span>(k <span class="sc">+</span> d <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>    <span class="fu">return</span>(term)</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>  }</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>  <span class="co"># computes and returns the sum</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>  compute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(a, d, max_k) {</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>    summation <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(<span class="dv">0</span><span class="sc">:</span>max_k, <span class="cf">function</span>(k) <span class="fu">compute_term</span>(a, d, k)))</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>    <span class="fu">return</span>(summation)</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>  }</span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;the sum when a = (1, 2):&quot;</span>, <span class="fu">compute_sum</span>(a, d, max_k), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-11.5" class="section level2">
<h2>Question 11.5</h2>
<p>Write a function to solve the equation for a Compare the solutions
with the points A(k) in Exercise 11.4.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>answer_11_5 <span class="ot">&lt;-</span> <span class="cf">function</span>(k_values) {</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="co"># function of the integral</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fu">gamma</span>((k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> (<span class="fu">sqrt</span>(pi <span class="sc">*</span> k) <span class="sc">*</span> <span class="fu">gamma</span>(k <span class="sc">/</span> <span class="dv">2</span>)))</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  }</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  ck <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k) {</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sqrt</span>((a<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> k) <span class="sc">/</span> (k <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> a<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>  }</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  integral_left <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k) {</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(u) (<span class="dv">1</span> <span class="sc">+</span> u<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (k <span class="sc">-</span> <span class="dv">1</span>))<span class="sc">^</span>(<span class="sc">-</span>k <span class="sc">/</span> <span class="dv">2</span>), <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="fu">ck</span>(a, k <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>    <span class="fu">return</span>(result<span class="sc">$</span>value)</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>  }</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>  integral_right <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k) {</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(u) (<span class="dv">1</span> <span class="sc">+</span> u<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> k)<span class="sc">^</span>(<span class="sc">-</span>(k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>), <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="fu">ck</span>(a, k))</span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>    <span class="fu">return</span>(result<span class="sc">$</span>value)</span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>  }</span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a>  <span class="co"># solve the equation for a</span></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a>  find_a <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>    f <span class="ot">&lt;-</span> <span class="cf">function</span>(a) {</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a>      left_term <span class="ot">&lt;-</span> <span class="fu">ratio</span>(k <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">integral_left</span>(a, k)</span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>      right_term <span class="ot">&lt;-</span> <span class="fu">ratio</span>(k) <span class="sc">*</span> <span class="fu">integral_right</span>(a, k)</span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">abs</span>(left_term <span class="sc">-</span> right_term))</span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a>    }</span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a>    solution <span class="ot">&lt;-</span> <span class="fu">optimize</span>(f, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fu">sqrt</span>(k)))<span class="sc">$</span>minimum</span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a>    <span class="fu">return</span>(solution)</span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a>  }</span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a>  a_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(k_values, find_a)</span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">data.frame</span>(<span class="at">k =</span> k_values, <span class="at">a =</span> a_values))</span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-4" class="section level2">
<h2>Question</h2>
<p>Suppose T1, . . . , Tn are i.i.d. samples drawn from the exponential
distribution with expectation λ. Those values greater than τ are not
observed due to right censorship, so that the observed values are Yi =
TiI(Ti ≤ τ) + τI(Ti &gt; τ), i = 1,…,n. Suppose τ = 1 and the observed
Yi values are as follows: 0.54, 0.48, 0.33, 0.43, 1.00, 1.00, 0.91,
1.00, 0.21, 0.85 Use the E-M algorithm to estimate λ, compare your
result with the observed data MLE (note: Yi follows a mixture
distribution).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>em_algo <span class="ot">&lt;-</span> <span class="cf">function</span>(epsilon, max_iter) {</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.54</span>, <span class="fl">0.48</span>, <span class="fl">0.33</span>, <span class="fl">0.43</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">0.91</span>, <span class="fl">1.00</span>, <span class="fl">0.21</span>, <span class="fl">0.85</span>)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  tau <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  <span class="cf">for</span> (iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_iter) {</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>    <span class="co"># E-step</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>    uncensor <span class="ot">&lt;-</span> Y[Y <span class="sc">&lt;</span> tau]</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>    censor <span class="ot">&lt;-</span> Y[Y <span class="sc">==</span> tau]</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>    n_uncensor <span class="ot">&lt;-</span> <span class="fu">length</span>(uncensor)</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>    n_censor <span class="ot">&lt;-</span> <span class="fu">length</span>(censor)</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>    E_T_censor <span class="ot">&lt;-</span> tau <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> lambda</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>    <span class="co"># M-step</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>    lambda_iter <span class="ot">&lt;-</span> (n_uncensor <span class="sc">+</span> n_censor) <span class="sc">/</span> (<span class="fu">sum</span>(uncensor) <span class="sc">+</span> n_censor <span class="sc">*</span> E_T_censor)</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(lambda_iter <span class="sc">-</span> lambda) <span class="sc">&lt;</span> epsilon) {</span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>      lambda <span class="ot">&lt;-</span> lambda_iter</span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>      <span class="cf">break</span> }</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> lambda_iter</span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>  }</span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;the E-M algorithm to estimate λ:&quot;</span>, lambda, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;the observed data MLE:&quot;</span>, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">mean</span>(Y), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-11.7" class="section level2">
<h2>Question 11.7</h2>
<p>Use the simplex algorithm to solve the following problem. Minimize 4x
+ 2y + 9z subject to 2x + y + z ≤ 2 x − y + 3z ≤ 3 x ≥ 0, y ≥ 0, z ≥
0.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>answer_11_7 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  f.obj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">9</span>)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  f.con <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  f.dir <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;&lt;=&quot;</span>, <span class="st">&quot;&lt;=&quot;</span>)</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  f.rhs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="co"># 使用lp函数求解最小化问题</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>  solution <span class="ot">&lt;-</span> lpSolve<span class="sc">::</span><span class="fu">lp</span>(<span class="st">&quot;min&quot;</span>, f.obj, f.con, f.dir, f.rhs)</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  <span class="co"># 输出结果</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  solution<span class="sc">$</span>objval</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-3-page-204-advanced-r" class="section level2">
<h2>Question 3 (page 204, Advanced R)</h2>
<p>Use both for loops and lapply() to fit linear models to the mtcars
using the formulas stored in this list: formulas &lt;- list( mpg ~ disp,
mpg ~ I(1 / disp), mpg ~ disp + wt, mpg ~ I(1 / disp) + wt )</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>answer_204_3 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>  datasets<span class="sc">::</span><span class="fu">data</span>(mtcars)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  formulas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>    mpg <span class="sc">~</span> disp,</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>    mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp),</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    mpg <span class="sc">~</span> disp <span class="sc">+</span> wt,</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>    mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp) <span class="sc">+</span> wt</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>  )</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>  <span class="co"># for loops to fit linear models</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>  lm_for <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(formulas)) {</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>    lm_for[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(formulas[[i]], <span class="at">data =</span> mtcars)</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>  }</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>  <span class="co"># lapply() to fit linear models</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>  lm_lapply <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulas, <span class="cf">function</span>(formula) <span class="fu">lm</span>(formula, <span class="at">data =</span> mtcars))</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>  <span class="co"># 输出拟合结果</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>  lm_for</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>  lm_lapply</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-4-page-204-advanced-r" class="section level2">
<h2>Question 4 (page 204, Advanced R)</h2>
<p>Fit the model mpg ~ disp to each of the bootstrap replicates of
mtcars in the list below by using a for loop and lapply(). Can you do it
without an anonymous function? bootstraps &lt;- lapply(1:10, function(i)
{ rows &lt;- sample(1:nrow(mtcars), rep = TRUE) mtcars[rows, ] })</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>answer_204_4 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>  datasets<span class="sc">::</span><span class="fu">data</span>(mtcars)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>  bootstraps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(i) {</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>    rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    mtcars[rows, ]</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>  })</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>  <span class="co"># using a for loop</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>  boot_for <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bootstraps)) {</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>    boot_for[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> bootstraps[[i]])</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>  }</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>  <span class="co"># using lapply()</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>  boot_lapply <span class="ot">&lt;-</span> <span class="fu">lapply</span>(bootstraps, <span class="cf">function</span>(data) <span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> data))</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>  <span class="co"># 输出拟合结果</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>  boot_for</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>  boot_lapply</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-5-page-204-advanced-r" class="section level2">
<h2>Question 5 (page 204, Advanced R)</h2>
<p>For each model in the previous two exercises, extract R2 using the
function below. rsq &lt;- function(mod) summary(mod)$r.squared</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>answer_204_5 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  datasets<span class="sc">::</span><span class="fu">data</span>(mtcars)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  formulas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>    mpg <span class="sc">~</span> disp,</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>    mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp),</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>    mpg <span class="sc">~</span> disp <span class="sc">+</span> wt,</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>    mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp) <span class="sc">+</span> wt</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>  )</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>  lm_for <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(formulas)) {</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>    lm_for[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(formulas[[i]], <span class="at">data =</span> mtcars)</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>  }</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>  lm_lapply <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulas, <span class="cf">function</span>(formula) <span class="fu">lm</span>(formula, <span class="at">data =</span> mtcars))</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>  bootstraps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(i) {</span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>    rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>    mtcars[rows, ]</span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>  })</span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>  boot_for <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bootstraps)) {</span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>    boot_for[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> bootstraps[[i]])</span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>  }</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>  boot_lapply <span class="ot">&lt;-</span> <span class="fu">lapply</span>(bootstraps, <span class="cf">function</span>(data) <span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> data))</span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a>  <span class="co"># extract R2 using the function below</span></span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a>  rsq <span class="ot">&lt;-</span> <span class="cf">function</span>(mod) <span class="fu">summary</span>(mod)<span class="sc">$</span>r.squared</span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a>  rsq_lm_for <span class="ot">&lt;-</span> <span class="fu">sapply</span>(lm_for, rsq)</span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a>  rsq_lm_lapply <span class="ot">&lt;-</span> <span class="fu">sapply</span>(lm_lapply, rsq)</span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a>  rsq_boot_for <span class="ot">&lt;-</span> <span class="fu">sapply</span>(boot_for, rsq)</span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a>  rsq_boot_lapply <span class="ot">&lt;-</span> <span class="fu">sapply</span>(boot_lapply, rsq)</span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a>  <span class="co"># 输出 R² 值</span></span>
<span id="cb28-30"><a href="#cb28-30" tabindex="-1"></a>  rsq_lm_for</span>
<span id="cb28-31"><a href="#cb28-31" tabindex="-1"></a>  rsq_lm_lapply</span>
<span id="cb28-32"><a href="#cb28-32" tabindex="-1"></a>  rsq_boot_for</span>
<span id="cb28-33"><a href="#cb28-33" tabindex="-1"></a>  rsq_boot_lapply</span>
<span id="cb28-34"><a href="#cb28-34" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-3-page-213-advanced-r" class="section level2">
<h2>Question 3 (page 213, Advanced R)</h2>
<p>The following code simulates the performance of a t-test for
non-normal data. Use sapply() and an anonymous function to extract the
p-value from every trial. trials &lt;- replicate( 100, t.test(rpois(10,
10), rpois(7, 10)), simplify = FALSE ) Extra challenge: get rid of the
anonymous function by using [[ directly.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>answer_213_3 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    <span class="dv">100</span>,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>    <span class="fu">t.test</span>(<span class="fu">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="fu">rpois</span>(<span class="dv">7</span>, <span class="dv">10</span>)),</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>    <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>  )</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>  <span class="co"># Use sapply() and an anonymous function</span></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>  p_val <span class="ot">&lt;-</span> <span class="fu">sapply</span>(trials, <span class="cf">function</span>(x) x<span class="sc">$</span>p.value)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>  p_val</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>  <span class="co"># Extra challenge</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>  p_val_ex <span class="ot">&lt;-</span> <span class="fu">sapply</span>(trials, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="st">&quot;p.value&quot;</span>)</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>  p_val_ex</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-6-page-214-advanced-r" class="section level2">
<h2>Question 6 (page 214, Advanced R)</h2>
<p>Implement a combination of Map() and vapply() to create an lapply()
variant that iterates in parallel over all of its inputs and stores its
outputs in a vector (or a matrix). What arguments should the function
take?</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>answer_214_6 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  parallel_lapply <span class="ot">&lt;-</span> <span class="cf">function</span>(..., FUN, <span class="at">FUN.VALUE =</span> <span class="cn">NA</span>) {</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>    results_list <span class="ot">&lt;-</span> <span class="fu">Map</span>(FUN, ...)</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>    <span class="fu">vapply</span>(results_list, <span class="at">FUN.VALUE =</span> FUN.VALUE, <span class="at">FUN =</span> identity)</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>  }</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">parallel_lapply</span>(x, y, <span class="at">FUN =</span> <span class="cf">function</span>(a, b) a <span class="sc">+</span> b, <span class="at">FUN.VALUE =</span> <span class="fu">numeric</span>(<span class="dv">1</span>))</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>  result</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-4-page-365-advanced-r" class="section level2">
<h2>Question 4 (page 365, Advanced R)</h2>
<p>Make a faster version of chisq.test() that only computes the
chi-square test statistic when the input is two numeric vectors with no
missing values. You can try simplifying chisq.test() or by coding from
the mathematical definition (<a href="http://en" class="uri">http://en</a>.
wikipedia.org/wiki/Pearson%27s_chi-squared_test).</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>answer_365_4 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  <span class="co"># Make a faster version of chisq.test()</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  fast_chisq_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(x)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.na</span>(y)) <span class="sc">||</span> <span class="fu">length</span>(x) <span class="sc">!=</span> <span class="fu">length</span>(y)) {</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;The input must be two numeric vectors with no missing values.&quot;</span>)</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>    }</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>    table_xy <span class="ot">&lt;-</span> <span class="fu">table</span>(x, y)</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    row_totals <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(table_xy, <span class="dv">1</span>)</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>    col_totals <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(table_xy, <span class="dv">2</span>)</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>    grand_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(table_xy)</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>    expected_counts <span class="ot">&lt;-</span> <span class="fu">outer</span>(row_totals, col_totals, <span class="at">FUN =</span> <span class="st">&quot;*&quot;</span>) <span class="sc">/</span> grand_total</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>    chisq_stat <span class="ot">&lt;-</span> <span class="fu">sum</span>((table_xy <span class="sc">-</span> expected_counts)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected_counts)</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>    <span class="fu">return</span>(chisq_stat)</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  }</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>  <span class="co"># Example</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>  <span class="fu">fast_chisq_test</span>(x, y)</span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-5-page-365-advanced-r" class="section level2">
<h2>Question 5 (page 365, Advanced R)</h2>
<p>Can you make a faster version of table() for the case of an input of
two integer vectors with no missing values? Can you use it to speed up
your chi-square test?</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>answer_365_5 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  <span class="co"># Make a faster version of table()</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  fast_table <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>    factor_x <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(x))</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>    factor_y <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(y))</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>    n_x <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(factor_x))</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>    n_y <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(factor_y))</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>    table_result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_x, <span class="at">ncol =</span> n_y)</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>      table_result[factor_x[i], factor_y[i]] <span class="ot">&lt;-</span> table_result[factor_x[i], factor_y[i]] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>    }</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>    <span class="fu">rownames</span>(table_result) <span class="ot">&lt;-</span> <span class="fu">levels</span>(<span class="fu">factor</span>(x))</span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>    <span class="fu">colnames</span>(table_result) <span class="ot">&lt;-</span> <span class="fu">levels</span>(<span class="fu">factor</span>(y))</span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>    <span class="fu">return</span>(table_result)</span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a>  }</span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a>  <span class="co"># Example</span></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a>  <span class="fu">fast_table</span>(x, y)</span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-5" class="section level2">
<h2>Question</h2>
<p>Write an Rcpp function for Exercise 9.8 (page 278, Statistical
Computing with R). Compare the corresponding generated random numbers
with those by the R function you wrote using the function “qqplot”.
Campare the computation time of the two functions with the function
“microbenchmark”. Comments your results.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>answer_9_8_Rccp <span class="ot">&lt;-</span> <span class="cf">function</span>(N, n, a, b) {</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="co"># 设定 Rcpp 环境</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  Rcpp<span class="sc">::</span><span class="fu">cppFunction</span>(<span class="st">&#39;</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="st">  NumericMatrix gibbsRcpp(int N, int n, double a, double b) {</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="st">      NumericMatrix result(N, 2);</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="st">      double y = R::runif(0, 1); // 初始 y 值</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="st">      for (int i = 0; i &lt; N; i++) {</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="st">          // 更新 x | y ~ Binomial(n, y)</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="st">          int x = R::rbinom(n, y);</span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="st">          // 更新 y | x ~ Beta(x + a, n - x + b)</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="st">          y = R::rbeta(x + a, n - x + b);</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="st">          result(i, 0) = x;</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="st">          result(i, 1) = y;</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="st">      return result;</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a><span class="st">  }&#39;</span>)</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>  <span class="co"># R 语言的 Gibbs 采样函数</span></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>  gibbsR <span class="ot">&lt;-</span> <span class="cf">function</span>(N, n, a, b) {</span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> N, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)  <span class="co"># 初始 y 值</span></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>          <span class="co"># 更新 x | y ~ Binomial(n, y)</span></span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a>          x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, y)</span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a>          <span class="co"># 更新 y | x ~ Beta(x + a, n - x + b)</span></span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a>          y <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x <span class="sc">+</span> a, n <span class="sc">-</span> x <span class="sc">+</span> b)</span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a>          result[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)</span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a>      }</span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a>      <span class="fu">return</span>(result)</span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a>  }</span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a>  <span class="co"># 使用 Rcpp 和 R 函数生成样本</span></span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a>  samples_rcpp <span class="ot">&lt;-</span> <span class="fu">gibbsRcpp</span>(N, n, a, b)</span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a>  samples_r <span class="ot">&lt;-</span> <span class="fu">gibbsR</span>(N, n, a, b)</span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a>  <span class="co"># Q-Q 图比较</span></span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a>  <span class="fu">qqplot</span>(samples_rcpp[, <span class="dv">1</span>], samples_r[, <span class="dv">1</span>], <span class="at">main =</span> <span class="st">&quot;Q-Q plot for X&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Rcpp&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;R&quot;</span>)</span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a>  <span class="fu">qqplot</span>(samples_rcpp[, <span class="dv">2</span>], samples_r[, <span class="dv">2</span>], <span class="at">main =</span> <span class="st">&quot;Q-Q plot for Y&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Rcpp&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;R&quot;</span>)</span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a>  <span class="co"># 计算性能比较</span></span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a>  benchmark_result <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a>      <span class="at">Rcpp =</span> <span class="fu">gibbsRcpp</span>(N, n, a, b),</span>
<span id="cb33-42"><a href="#cb33-42" tabindex="-1"></a>      <span class="at">R =</span> <span class="fu">gibbsR</span>(N, n, a, b)</span>
<span id="cb33-43"><a href="#cb33-43" tabindex="-1"></a>  )</span>
<span id="cb33-44"><a href="#cb33-44" tabindex="-1"></a>  <span class="fu">print</span>(benchmark_result)</span>
<span id="cb33-45"><a href="#cb33-45" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
